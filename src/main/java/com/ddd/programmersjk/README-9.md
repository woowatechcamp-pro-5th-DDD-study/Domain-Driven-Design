# 9. 도메인 모델과 바운디드 컨텍스트

## 9.1 도메인 모델과 경계
- 처음 도메인 모델을 만들때 빠지기 쉬운 함정으로 도메인을 완벽하게 표현하는 단일 모델을 만드는 시도를 하는 것이다.
- 논리적으로 같은 존재처럼 보이지만 하위 도메인에 따라 다른 용어를 사용하는 경우가 있다. 카탈로그 도메인에서는 상품이지만
검색도메인에서는 상품이 아닌 문서로 불리기도 한다. 시스템을 사용하는 사람을 회원 도메인에서는 회원이지만 주문 도메인에서는 주문자라고 부르기도 한다.
- 이렇게 하위 도메인마다 같은 용어라도 의미가 다를수 있기 때문에 한개의 모델로 모든 하위 도메인을 표현하려는 시도는 올바른 방법이 아니다.
- 하위 도메인마다 사용하는 용어가 다르기 때문에 올바른 도메인 모델을 개발하려면 하위 도메인마다 모델을 만들어야 한다. 각 모델은 경계를 가져서
섞이지 않도록 해야하며 이렇게 구분되는 경계를 DDD에서는 **바운디드 컨텍스트**라고 부른다.

## 9.2 바운디드 컨텍스트
- 바운디드 컨텍스트는 모델의 경계를 결정하며 한 개의 바운디드 컨텍스트는 논리적으로 한 개의 모델을 가진다.
- 바운디드 컨텍스트는 용어를 기준으로 구분하는데 카탈로그와 재고 컨텍스트는 서로 다른 용어를 사용하므로 이 용어를 기준으로 컨텍스트를 분리할 수 있다.
- 이상적으로 하위 도메인과 바운디드 컨텍스트가 일대일 관계를 가지면 좋겠지만 현실은 그렇지 않을떄가 많다. 바운디드 컨텍스트는 팀 조직 구조에
따라 결정되기도 한다.

## 9.3 바운디드 컨텍스트
- 바운디드 컨텍스트가 도메인 모델만 포함하는 것은 아니다. 바운디드 컨텍스트는 도메인, 표현, 응용, 인프라 영역까지 모두 포함한다.
쉽게 말해 **도메인 기능을 제공하는데 필요한 모든 요소를 포함**한다.
- 모든 바운디드 컨텍스트를 반드시 도메인 주도로 개발할 필요는 없다. 상품의 리뷰같은 간단한 로직들은 복잡한 도메인 로직을 갖지 않기 때문에
서비스 + DAO를 이용해서 구현해도 된다.
- 각 바운디드 컨텍스트는 서로 다른 구현기술을 사용할 수 있다. 스프링과 JPA를 쓰는 바운디드 컨텍스트가 존재할수도 있고 Netty를 이용해
REST API를 제공하는 바운디드 컨텍스트가 존재할 수도 있다.

## 9.4 바운디드 컨텍스트간 통합
- 쇼핑몰에서 매출을 위해 카탈로그에 개인화 추천기능을 도입하기로 했다. 새로운 팀이 이를 맡기로 가정하면 카타로그 하위 도메인으로
카탈로그를 위한 바운디드 컨텍스트와 개인 추천기능을 위한 바운디드 컨텍스트가 생긴다.
- 이때 카탈로그와 추천 컨텍스트의 도메인 모델은 서로 다르다. 카탈로그는 제품을 중심으로 도메인 모델을 구현하지만 추천은 추천 연산을
위한 모델을 구현한다.
- 카탈로그 시스템에선 추천 도메인 모델에 REST API로 데이터를 받아 제공한다. 이 방식은 두 바운디드 컨텍스트를 직접 통합하는 방법이다.
- 간접적으로 통합하는 방식도 있는데 이떄는 메시지 큐를 사용한다. 카탈로그 바운디드 컨텍스트는 추천 시스템이 필요로 하는 사용자 활동 이력을
메시지 큐에 추가한다. 메시지 큐는 비 동기로 메시지를 처리하기 때문에 카탈로그 바운디드 컨텍스트는 메시지를 큐로 보낸 후 기다리지 않고 바로
자신이 할 일을 이어 작업한다.
- 추천 바운디드 컨텍스트는 큐에서 이런 메시지를 읽어와 추천을 계산하는데 사용할 것이다. 이 말은 두 바운디드 컨텍스트가 사용할 메시지의
데이터 구조를 맞춰야 함을 의미한다. 
- 어떤 도메인 관점에서 모델을 사용하느냐에 따라 두 바운디드 컨텍스트의 구현 코드가 달라질 수 있다. 카탈로그 도메인 관점에서 큐에 저장할
메시지를 생성하면 카탈로그는 그대로 데이터를 메시지 큐에 저장하고 추천 시스템은 이를 받아 자신의 모델에 맞게 메시지를 변환해야 한다.
반대로 추천 시스템이 큐에 저장할 메시지를 넣는다면 카탈로그 측에서 메시지를 변환해야 한다.
- 바운디드 컨텍스트를 마이크로서비스로 구현하면 자연스럽게 컨텍스트 별로 모델이 분리된다. 마이크로 서비스마다 프로젝트를 생성하므로
  바운디드 컨텍스트마다 프로젝트를 만들게 되고 각 바운디드 컨텍스트의 모델이 섞이지 않도록 해준다.

## 9.5 바운디드 컨텍스트간 관계
- 바운디드 컨텍스트 관계 중 가장 흔한 관계는 한쪽에서 API를 제공하고 다른쪽에서 그 API를 호출하는 관계이다.
카탈로그 바운디드 컨텍스트는 추천 상품을 보여주기 위해 추천 바운디드 컨텍스트가 제공하는 REST API를 호출한다.
- 추천 바운디드 컨텍스트는 일종의 공급자 역할을 하고 카탈로그는 서비스를 사용하는 고객 역할을 한다. 이때 이 두 팀은 상호협력이 필수적이다.
- 상류팀의 고객에 하류팀이 다수 존재하면 여러 하류팀의 요구사항을 충족할 수 있는 API를 만들어 제공해야 하는데 대표적인 예가 검색이다.
블로그, 카페, 게시판과 같은 서비스를 제공하는 포털은 각 서비스별로 검색기능을 구현하기 보다는 검색을 위한 전용 시스템을 구축하고
검색 시스템과 각 하류 서비스를 통합한다.
- 두 바운디드 컨텍스트가 같은 모델을 공유하는 경우도 있다. 이 방법은 중복을 줄여주는 장점을 가지는 대신에 두 팀이 밀접한 관계를 유지해야 한다.
만약 밀접하게 두 팀이 움직이지 않는다면 공유 방법의 장점보다 공유 모델로 개발이 지연되고 정체되는 문제가 더 커지게 된다.

## 9.6 컨텍스트 맵
- 개별 바운디드 컨텍스트에 매몰되면 전체를 보지 못할 때가 있다. 전체 비지니스를 볼 수 있는 방법이 필요한데 이게 컨텍스트 맵이다.
- 바운디드 컨텍스트 영역에 주요 애그리거트를 함께 표시하고 오픈 호스트 서비스(OHS)와 안티코렵션 계층(ACL) 표시해 전체 관계를 이해하는데 도움이 되도록 한다.
- 컨텍스트 맵을 그리는 규칙은 따로 없다. 간단한 도형과 선을 이용해 각 컨텍스트를 이해할 수 있는 수준에서 그리면 된다. 컨텍스트 맵은 단순하기 
때문에 화이트보드나 파워포인트 같은 도구를 이용해서 쉽게 그릴 수 있다.